# Rails and Javascript

JUMPING TO...

## What's an API
Let's say you're building an app that allows users to find the nearest coffee shop that is most likely to have an open table where they can sit and work on their novel.
You need to be able to search for coffee shops and find out things like how many people have recently gone there.
One of the great things about the web is that we can find all kinds of data and use it in new and interesting ways. In this case, we know that Foursquare deals with exactly that sort of thing, so we'll try to get data from them.

One thing we could do is screen-scrape Foursquare, but you do so in code so that instead of seeing rendered HTML, you have to `parse` the HTML to see what you want. So, we could go to Foursquare and use their search feature and look at the URL generated by the search to figure out how to create our own request. In this case, searching for coffee shops in New York would generate a URL like this:
`https://foursquare.com/explore?mode=url&near=New%20York&q=coffee%20shops`
We could then use Nokogiri and Ruby to request that page and parse the data.
```ruby
# irb
doc = Nokogiri::HTML(open('https://foursquare.com/explore?mode=url&near=New%20York&q=coffee%20shops'))

doc.css('li.singleRecommendation').each do |recommendation|
  # ...
end
```
We could inspect that source and figure out that the results are all in `<li>` elements with a `class="singleRecommendation"`. Now what happens when Foursquare does a minor CSS tweak and changes `.singleRecommendation` to `.recommendationCard`. Our whole app is broken! And we won't know about it until a user gets an error. And Foursquare has no responsibility to us because scraping their page is not an intended use of their system.

Okay, instead of spending hours and hours parsing their new HTML, let's see if they have an API. Some applications, knowing that their data might be of use to other applications, provide an API as well as the standard web interface.

An API (Application Programming Interface) is a way for one system to interact with another via a well-defined interface. **An interface is any endpoint that can be used to take actions and consume data on a given application**. 

The HTML response of every web site is an interface, for instance. The web interface provides HTML, which is a combination of data (the dynamic values like venue names, addresses, and check-ins) and presentation (HTML tags, CSS classes, JavaScript effects) meant to be consumed by a web browser. This is great for end users who want to see something visually compelling.

The benefit of an API is that it's put together explicitly for the purpose of being used by another system, rather than being viewed by a human, so the data that it returns is unencumbered by the presentation, preventing the consuming code from having to wade through HTML just to find values. A good API just provides data in the easiest format possible for code to digest.

Most modern web APIs use `JavaScript Object Notation`, or `JSON`, as a standard way of describing and defining data. Some APIs, usually older ones, will use `XML` rather than `JSON` to describe data, though that is increasingly rare. However, the remnants of that great stone age are found in AJAX, which stands for Asynchronous JavaScript and XML, XML being the standard when AJAX hit the scene. **When we use AJAX today we're almost always using JSON rather than XML, but we haven't changed the name because AJAJ would be a weird acronym.**

JSON looks a lot like a Ruby hash, and as a result, figuring out how to access a given piece of data is a snap.
```json
{
  "name": "Cuppa Joe's",
  "address": "123 Not A Fake Address Street",
  "city": "Real City",
  "state": "New York",
  "zip": "10015"
}
```
//Flat-fact: JSON is canonically pronounced like the name "Jason", because it makes it easy to carve up data

Most good APIs also use REST, just like Rails, so finding your way around should start to feel familiar and consistent as you learn what resources are available. Keep in mind, though, that you will only have access to what the API creator allows.

### APIs and Postman
The first thing we want to do is install a couple of tools to make our lives a lot easier.
- Postman is a Chrome app that we can use to easily make API requests. Check out the docs and install the app from here.
- JSONView is a Chrome extension that will automatically make JSON data much more readable in Chrome.

Let's try to get venue data on Foursquare. We'll check out the Venues endpoint in the documentation. Venue Detail is the name of the function, or `endpoint`, that we are going to use, and its URI takes the format: `https://api.foursquare.com/v2/venues/VENUE_ID`. This RESTful URI looks a lot like one we'd use in a Rails app to allow access to a given venue. The document tells us that we will need to access this endpoint with the HTTP `GET` verb, and that `VENUE_ID` is a parameter that we will need to provide.

API SECRET: Most API providers require a similar process to use their API: creating an app will give us a client ID and a secret that we can use as credentials for the API. Rhe client ID/secret pair authorizes the application access the API. API providers want to know who is accessing their API. There are several reasons for this, but an important one is quality control.

Let's say one bad application is using the API in unintended ways, perhaps making too many requests in a short period of time. This is problematic because it can negatively affect other API users who are behaving appropriately. By requiring a client ID/secret authorization, Foursquare can know who the offender is and turn off their access, ensuring quality for other API users.

Let's create the app and do the request
`https://api.foursquare.com/v2/venues/40a55d80f964a52020f31ee3?client_id=YOUR_CLIENT_ID&client_secret=YOUR_SECRET&v=20150201`
It should return something like
```json
response: {
  venue: {
    id: "40a55d80f964a52020f31ee3",
    name: "Clinton St. Baking Co. & Restaurant",
    contact: {
    phone: "6466026263",
    formattedPhone: "(646) 602-6263"
  },
  location: {
    address: "4 Clinton St",
    crossStreet: "at E Houston St",
    lat: 40.72107924768216,
    lng: -73.98394256830215,
    postalCode: "10002",
    cc: "US",
    city: "New York",
    state: "NY",
    country: "United States",
    formattedAddress: [
      "4 Clinton St (at E Houston St)",
      "New York, NY 10002",
      "United States"
    ]
  },
// ...
```
Note: Remember that with a `GET` request, we pass parameters via a `querystring` by putting a `?` after the url and then formatting parameters like this: `param=value&param2=value`.

Typing all that into the URL bar of our browser every time is tedious, and makes it easy to make a mistake, so we can use Postman, which will make it much easier to deal with parameters, headers, and anything else we might need to do to explore an API.
Open postman, then enter the base URL in the URL field: `https://api.foursquare.com/v2/venues/40a55d80f964a52020f31ee3`. Then click Params, and you can enter each parameter separately below. Enter the following three things in the appropriate columns:
```
URL Parameter Key        Value
client_id               YOUR CLIENT ID
client_secret           YOUR SECRET
v                       20160201
```
The `v` parameter we passed in was a version parameter that the Foursquare API requires. Try taking it out by deleting the v parameter and value from Postman and hitting "Send" again.

Versioning is an important tool in API use. When an API changes, either because of new features or changed endpoints, not all API clients will be able to keep up with those changes immediately: any application using the API would run the risk of being broken until they updated their code.
By versioning the API, you can guarantee that anyone using the current version can keep using it, and upgrade to the new version when they can. You leave the old endpoints in place (e.g. `https://api.foursquare.com/v1/venues`) and roll out a new one under a new version namespace (e.g. `https://api.foursquare.com/v2/venues`).





